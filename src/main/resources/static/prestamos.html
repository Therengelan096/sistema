<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prestamos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #121212;
        color: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }

    h1 {
        color: #ff69b4;
        text-shadow: 0 4px 8px rgba(255, 105, 180, 0.8);
        margin-bottom: 20px;
    }

    table {
        width: 80%;
        max-width: 800px;
        background-color: #222;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(255, 105, 180, 0.4);
    }

    th, td {
        border: 1px solid #333;
        padding: 12px;
        text-align: left;
    }

    th {
        background-color: #ff69b4;
    }

    tr:nth-child(even) {
        background-color: #333;
    }

    .modal {
        color: black;
    }
  </style>
</head>
<body>
<h1>Prestamos</h1>
<button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addModal">Agregar Prestamo</button>
<div class="table-container">
  <table>
    <thead>
    <tr>
      <th>ID</th>
      <th>Usuario</th>
      <th>Equipo</th>
      <th>Administrador</th>
      <th>Fecha Prestamo</th>
      <th>Hora Prestamo</th>
      <th>Estado</th>
      <th>Fecha Devolución Estimada</th>
      <th>Acciones</th>
    </tr>
    </thead>
    <tbody id="prestamos-body"></tbody>
  </table>
</div>

<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addModalLabel">Agregar Prestamo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addForm">
          <div class="mb-3">
            <label for="usuarioId" class="form-label">Usuario ID</label>
            <input type="number" class="form-control" id="usuarioId" required>
          </div>
          <div class="mb-3">
            <label for="equipoId" class="form-label">Equipo ID</label>
            <input type="number" class="form-control" id="equipoId" required>
          </div>
          <div class="mb-3">
            <label for="administradorUsuario" class="form-label">Administrador Usuario</label>
            <input type="text" class="form-control" id="administradorUsuario" required>
          </div>
          <div class="mb-3">
            <label for="fechaPrestamo" class="form-label">Fecha Prestamo</label>
            <input type="date" class="form-control" id="fechaPrestamo" required>
          </div>
          <div class="mb-3">
            <label for="horaPrestamo" class="form-label">Hora Prestamo</label>
            <input type="time" class="form-control" id="horaPrestamo" required>
          </div>
          <div class="mb-3">
            <label for="estado" class="form-label">Estado</label>
            <input type="text" class="form-control" id="estado" required>
          </div>
          <div class="mb-3">
            <label for="fechaDevolucionEstimada" class="form-label">Fecha Devolución Estimada</label>
            <input type="date" class="form-control" id="fechaDevolucionEstimada" required>
          </div>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Modificar Prestamo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editForm">
          <input type="hidden" id="editIdPrestamo">
          <div class="mb-3">
            <label for="editUsuarioId" class="form-label">Usuario ID</label>
            <input type="number" class="form-control" id="editUsuarioId" required>
          </div>
          <div class="mb-3">
            <label for="editEquipoId" class="form-label">Equipo ID</label>
            <input type="number" class="form-control" id="editEquipoId" required>
          </div>
          <div class="mb-3">
            <label for="editAdministradorUsuario" class="form-label">Administrador Usuario</label>
            <input type="text" class="form-control" id="editAdministradorUsuario" required>
          </div>
          <div class="mb-3">
            <label for="editFechaPrestamo" class="form-label">Fecha Prestamo</label>
            <input type="date" class="form-control" id="editFechaPrestamo" required>
          </div>
          <div class="mb-3">
            <label for="editHoraPrestamo" class="form-label">Hora Prestamo</label>
            <input type="time" class="form-control" id="editHoraPrestamo" required>
          </div>
          <div class="mb-3">
            <label for="editEstado" class="form-label">Estado</label>
            <input type="text" class="form-control" id="editEstado" required>
          </div>
          <div class="mb-3">
            <label for="editFechaDevolucionEstimada" class="form-label">Fecha Devolución Estimada</label>
            <input type="date" class="form-control" id="editFechaDevolucionEstimada" required>
          </div>
          <button type="submit" class="btn btn-primary">Actualizar</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function fetchPrestamos() {
    fetch('http://localhost:8083/prestamos')
      .then(response => response.json())
      .then(data => {
        const tableBody = document.getElementById('prestamos-body');
        tableBody.innerHTML = '';
        data.forEach(item => {
          tableBody.innerHTML += `
            <tr>
              <td>${item.idPrestamo}</td>
              <td>${item.usuario.nombre}</td>
              <td>${item.equipo.nombre}</td>
              <td>${item.administrador.usuario}</td>
              <td>${item.fechaPrestamo}</td>
              <td>${item.horaPrestamo}</td>
              <td>${item.estado}</td>
              <td>${item.fechaDevolucionEstimada}</td>
              <td>
                <button class="btn btn-sm btn-warning edit-btn" data-id="${item.idPrestamo}">Editar</button>
              </td>
            </tr>
          `;
        });
        addEventListeners();
      })
      .catch(error => console.error('Error:', error));
  }
  fetchPrestamos();

  function addEventListeners() {
    document.querySelectorAll('.edit-btn').forEach(button => {
      button.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        fetch(`http://localhost:8083/prestamos/${id}`)
          .then(response => response.json())
          .then(item => {
            document.getElementById('editIdPrestamo').value = item.idPrestamo;
            document.getElementById('editUsuarioId').value = item.usuario.idUsuario;
            document.getElementById('editEquipoId').value = item.equipo.idEquipo;
            document.getElementById('editAdministradorUsuario').value = item.administrador.usuario;
            document.getElementById('editFechaPrestamo').value = item.fechaPrestamo;
            document.getElementById('editHoraPrestamo').value = item.horaPrestamo;
            document.getElementById('editEstado').value = item.estado;
            document.getElementById('editFechaDevolucionEstimada').value = item.fechaDevolucionEstimada;
            new bootstrap.Modal(document.getElementById('editModal')).show();
          })
          .catch(error => console.error('Error:', error));
      });
    });
  }

  document.getElementById('addForm').addEventListener('submit', function(event) {
    event.preventDefault();
    const usuarioId = document.getElementById('usuarioId').value;
    const equipoId = document.getElementById('equipoId').value;
    const adminUsuario = document.getElementById('administradorUsuario').value;
    const fechaPrestamo = document.getElementById('fechaPrestamo').value;
    const horaPrestamo = document.getElementById('horaPrestamo').value;
    const estado = document.getElementById('estado').value;
    const fechaDevolucion = document.getElementById('fechaDevolucionEstimada').value;

    fetch('http://localhost:8083/prestamos', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        usuario: { idUsuario: parseInt(usuarioId) },
        equipo: { idEquipo: parseInt(equipoId) },
        administrador: { usuario: adminUsuario },
        fechaPrestamo: fechaPrestamo,
        horaPrestamo: horaPrestamo,
        estado: estado,
        fechaDevolucionEstimada: fechaDevolucion
      })
    })
    .then(() => {
        fetchPrestamos();
        new bootstrap.Modal(document.getElementById('addModal')).hide();
        document.getElementById('addForm').reset();
    })
    .catch(error => console.error('Error:', error));
  });

    document.getElementById('editForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const idPrestamo = document.getElementById('editIdPrestamo').value;
        const usuarioId = document.getElementById('editUsuarioId').value;
        const equipoId = document.getElementById('editEquipoId').value;
        const adminUsuario = document.getElementById('editAdministradorUsuario').value;
        const fechaPrestamo = document.getElementById('editFechaPrestamo').value;
        const horaPrestamo = document.getElementById('editHoraPrestamo').value;
        const estado = document.getElementById('editEstado').value;
        const fechaDevolucion = document.getElementById('editFechaDevolucionEstimada').value;

        fetch(`http://localhost:8083/prestamos/${idPrestamo}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                idPrestamo: parseInt(idPrestamo),
                usuario: { idUsuario: parseInt(usuarioId) },
                equipo: { idEquipo: parseInt(equipoId) },
                administrador: { usuario: adminUsuario },
                fechaPrestamo: fechaPrestamo,
                horaPrestamo: horaPrestamo,
                estado: estado,
                fechaDevolucionEstimada: fechaDevolucion
            })
        })
            .then(() => {
                fetchPrestamos();
                new bootstrap.Modal(document.getElementById('editModal')).hide();
            })
            .catch(error => console.error('Error:', error));
    });

</script>
</body>
</html>